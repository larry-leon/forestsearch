% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate_aft_dgm_flexible.R
\name{generate_aft_dgm_flex}
\alias{generate_aft_dgm_flex}
\title{Generate Synthetic Survival Data using AFT Model with Flexible Subgroups}
\usage{
generate_aft_dgm_flex(
  data,
  continuous_vars,
  factor_vars,
  outcome_var,
  event_var,
  treatment_var = NULL,
  subgroup_vars = NULL,
  subgroup_cuts = NULL,
  draw_treatment = FALSE,
  model = "alt",
  k_treat = 1,
  k_inter = 1,
  n_super = 5000,
  cens_type = "weibull",
  cens_params = list(),
  seed = 8316951,
  verbose = TRUE,
  standardize = FALSE
)
}
\arguments{
\item{data}{A data.frame containing the input dataset to base the simulation on}

\item{continuous_vars}{Character vector of continuous variable names to be
standardized and included as covariates}

\item{factor_vars}{Character vector of factor/categorical variable names to be
converted to dummy variables (largest value as reference)}

\item{outcome_var}{Character string specifying the name of the outcome/time variable}

\item{event_var}{Character string specifying the name of the event/status variable
(1 = event, 0 = censored)}

\item{treatment_var}{Character string specifying the name of the treatment variable.
If NULL, treatment will be randomly simulated with 50/50 allocation}

\item{subgroup_vars}{Character vector of variable names defining the subgroup.
Default is NULL (no subgroups)}

\item{subgroup_cuts}{Named list of cutpoint specifications for subgroup variables.
See Details section for flexible specification options}

\item{draw_treatment}{Logical indicating whether to redraw treatment assignment
in simulation. Default is FALSE (use original assignments)}

\item{model}{Character string: "alt" for alternative model with subgroup effects,
"null" for null model without subgroup effects. Default is "alt"}

\item{k_treat}{Numeric treatment effect modifier. Values >1 increase treatment
effect, <1 decrease it. Default is 1 (no modification)}

\item{k_inter}{Numeric interaction effect modifier for treatment-subgroup interaction.
Default is 1 (no modification)}

\item{n_super}{Integer specifying size of super population to generate.
Default is 5000}

\item{cens_type}{Character string specifying censoring distribution: "weibull"
or "uniform". Default is "weibull"}

\item{cens_params}{List of parameters for censoring distribution. For uniform:
list(min = value, max = value). For Weibull: fitted from data}

\item{seed}{Integer random seed for reproducibility. Default is 8316951}

\item{verbose}{Logical indicating whether to print diagnostic information during
execution. Default is TRUE}

\item{standardize}{Logical indicating whether to standardize continuous variables.
Default is FALSE}
}
\value{
An object of class \code{c("aft_dgm_flex", "list")} containing:
\describe{
\item{df_super}{Data frame with the super population including all covariates,
linear predictors, and potential outcomes}
\item{model_params}{List containing model parameters:
\describe{
\item{mu}{Intercept from AFT model}
\item{sigma}{Scale parameter}
\item{gamma}{Vector of regression coefficients}
\item{b_weibull}{Weibull parameterization coefficients}
\item{b0_weibull}{Weibull baseline hazard coefficients}
\item{censoring}{Censoring distribution parameters}
}}
\item{subgroup_info}{List with subgroup information:
\describe{
\item{vars}{Variables used to define subgroup}
\item{cuts}{Cutpoint specifications used}
\item{definitions}{Human-readable subgroup definitions}
\item{size}{Number of observations in subgroup}
\item{proportion}{Proportion of observations in subgroup}
}}
\item{hazard_ratios}{List of true hazard ratios:
\describe{
\item{overall}{Overall treatment HR}
\item{harm_subgroup}{HR within subgroup (if model="alt")}
\item{no_harm_subgroup}{HR outside subgroup (if model="alt")}
}}
\item{analysis_vars}{List of variable classifications for analysis}
\item{model_type}{Character: "alt" or "null"}
\item{n_super}{Size of super population}
\item{seed}{Random seed used}
}
}
\description{
Creates a data generating mechanism (DGM) for survival data using an Accelerated
Failure Time (AFT) model with Weibull distribution. Supports flexible subgroup
definitions and treatment-subgroup interactions.
}
\details{
\subsection{Subgroup Cutpoint Specifications}{

The \code{subgroup_cuts} parameter accepts multiple flexible specifications:
\subsection{Fixed Value}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(er = 20)  # er <= 20
}\if{html}{\out{</div>}}
}

\subsection{Quantile-based}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(
  er = list(type = "quantile", value = 0.25)  # er <= 25th percentile
)
}\if{html}{\out{</div>}}
}

\subsection{Function-based}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(
  er = list(type = "function", fun = median)  # er <= median
)
}\if{html}{\out{</div>}}
}

\subsection{Range}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(
  age = list(type = "range", min = 40, max = 60)  # 40 <= age <= 60
)
}\if{html}{\out{</div>}}
}

\subsection{Greater than}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(
  nodes = list(type = "greater", quantile = 0.75)  # nodes > 75th percentile
)
}\if{html}{\out{</div>}}
}

\subsection{Multiple values (for categorical)}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(
  grade = list(type = "multiple", values = c(2, 3))  # grade in (2, 3)
)
}\if{html}{\out{</div>}}
}

\subsection{Custom function}{

\if{html}{\out{<div class="sourceCode r">}}\preformatted{subgroup_cuts = list(
  er = list(
    type = "custom",
    fun = function(x) x <= quantile(x, 0.3) | x >= quantile(x, 0.9)
  )
)
}\if{html}{\out{</div>}}
}

}

\subsection{Model Structure}{

The AFT model with Weibull distribution is specified as:
\deqn{\log(T) = \mu + \gamma' X + \sigma \epsilon}

Where:
\itemize{
\item T is the survival time
\item μ is the intercept
\item γ contains the covariate effects
\item X includes treatment, covariates, and treatment×subgroup interaction
\item σ is the scale parameter
\item ε follows an extreme value distribution
}
}

\subsection{Interaction Term}{

The model creates a SINGLE interaction term representing the treatment effect
modification when ALL subgroup conditions are simultaneously satisfied. This
is not multiple separate interactions but one combined indicator.
}
}
\examples{
\dontrun{
library(survival)
data(cancer)

# Example 1: Simple fixed cutpoints
dgm1 <- generate_aft_dgm_flex(
  data = gbsg,
  continuous_vars = c("age", "size", "nodes", "pgr", "er"),
  factor_vars = c("meno", "grade"),
  outcome_var = "rfstime",
  event_var = "status",
  treatment_var = "hormon",
  subgroup_vars = c("er", "meno"),
  subgroup_cuts = list(
    er = 20,         # Fixed value
    meno = 0         # Factor level
  ),
  model = "alt",
  verbose = TRUE
)

# Example 2: Quantile-based cutpoints
dgm2 <- generate_aft_dgm_flex(
  data = gbsg,
  continuous_vars = c("age", "size", "nodes", "pgr", "er"),
  factor_vars = c("meno", "grade"),
  outcome_var = "rfstime",
  event_var = "status",
  treatment_var = "hormon",
  subgroup_vars = c("er", "pgr", "age"),
  subgroup_cuts = list(
    er = list(type = "quantile", value = 0.25),
    pgr = list(type = "function", fun = median),
    age = list(type = "range", min = 40, max = 60)
  ),
  model = "alt",
  k_inter = 2,  # Double the interaction effect
  verbose = TRUE
)

# Print summary
print(dgm2)
}

}
\references{
Kalbfleisch, J.D. and Prentice, R.L. (2002). The Statistical Analysis of
Failure Time Data (2nd ed.). Wiley.
}
\seealso{
\code{\link{simulate_from_dgm}} for generating simulated data from the DGM
\code{\link{find_quantile_for_proportion}} for finding quantiles that achieve
target subgroup proportions
}
\author{
Your Name
}
