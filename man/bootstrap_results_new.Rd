% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/bootstrap_dofuture.R
\name{bootstrap_results_new}
\alias{bootstrap_results_new}
\title{Bootstrap Results for ForestSearch with Bias Correction}
\usage{
bootstrap_results_new(
  fs.est,
  df_boot_analysis,
  cox.formula.boot,
  nb_boots,
  show_three,
  H_obs,
  Hc_obs
)
}
\arguments{
\item{fs.est}{List. ForestSearch results object from \code{\link{forestsearch}}.
Must contain:
\itemize{
\item \code{df.est}: Data frame with analysis data including \code{treat.recommend}
\item \code{confounders.candidate}: Character vector of confounder names
\item \code{args_call_all}: List of original forestsearch call arguments
}}

\item{df_boot_analysis}{Data frame. Bootstrap analysis data with same structure
as \code{fs.est$df.est}. Must contain columns for outcome, event, treatment,
and the \code{treat.recommend} flag.}

\item{cox.formula.boot}{Formula. Cox model formula for bootstrap, typically
created by \code{\link{build_cox_formula}}. Should be of form
\code{Surv(outcome, event) ~ treatment}.}

\item{nb_boots}{Integer. Number of bootstrap samples to generate (e.g., 500-1000).
More iterations provide better bias correction but increase computation time.}

\item{show_three}{Logical. If \code{TRUE}, prints detailed progress for the
first three bootstrap iterations for debugging purposes. Default: \code{FALSE}.}

\item{H_obs}{Numeric. Observed log hazard ratio for subgroup H (harm group,
\code{treat.recommend == 0}) from original sample. Used as reference for
bias correction.}

\item{Hc_obs}{Numeric. Observed log hazard ratio for subgroup H^c (complement,
\code{treat.recommend == 1}) from original sample. Used as reference for
bias correction.}
}
\value{
Data.table with one row per bootstrap iteration and columns:
\describe{
\item{H_biasadj_1}{Bias-corrected estimate for H using method 1:
\code{H_obs - (H_boot_boot - H_boot_obs)}}
\item{H_biasadj_2}{Bias-corrected estimate for H using method 2:
\code{2*H_obs - (H_boot + H_boot_boot - H_boot_obs)}}
\item{Hc_biasadj_1}{Bias-corrected estimate for H^c using method 1}
\item{Hc_biasadj_2}{Bias-corrected estimate for H^c using method 2}
\item{tmins_search}{Numeric. Minutes spent on subgroup search in this iteration}
\item{max_sg_est}{Numeric. Maximum subgroup hazard ratio found}
\item{prop_maxk}{Numeric. Proportion of maximum K factors used}
\item{L}{Integer. Number of candidate factors evaluated}
\item{max_count}{Integer. Maximum number of factor combinations}
}
Rows where no valid subgroup was found will have \code{NA} for bias corrections.
}
\description{
Runs bootstrap analysis for ForestSearch, fitting Cox models and computing
bias-corrected estimates using the .632+ bootstrap method. Each bootstrap
iteration re-runs the full ForestSearch pipeline to capture variability in
subgroup identification.
}
\note{
This function is designed to be called within a \code{foreach} loop
with \code{\%dofuture\%} operator. It requires:
\itemize{
\item All functions in \code{\link{get_bootstrap_exports}} to be available
in the parallel workers
\item Packages listed in \code{BOOTSTRAP_REQUIRED_PACKAGES} to be installed
\item Proper parallel backend setup via \code{\link{setup_parallel_SGcons}}
}
}
\section{Bias Correction Methods}{

The function implements two bias correction approaches:
\enumerate{
\item \strong{Method 1 (Simple)}: Corrects for optimism using the difference
between bootstrap internal validation (\code{H_boot_boot}) and
bootstrap-on-original (\code{H_boot_obs})
\item \strong{Method 2 (Double)}: Uses both the bootstrap estimate and the
optimism correction for a more conservative adjustment
}
}

\section{Computational Details}{

\itemize{
\item Uses \code{doFuture} backend for parallel execution (configured externally)
\item Sets reproducible seeds: \code{8316951 + boot * 100} for each iteration
\item Each bootstrap iteration runs full ForestSearch pipeline including
variable selection, subgroup search, and consistency evaluation
\item Sequential execution within each bootstrap prevents nested parallelization
\item Failed bootstrap iterations generate warnings but don't stop execution
}
}

\section{Performance Considerations}{

\itemize{
\item Typical runtime: 1-5 seconds per bootstrap iteration
\item For 1000 bootstraps with 6 workers: ~3-10 minutes total
\item Memory usage scales with dataset size and number of workers
\item Consider reducing \code{nb_boots} for initial testing (e.g., 100)
}
}

\examples{
\dontrun{
# Typically called via forestsearch_bootstrap_dofuture()
# Manual usage for debugging:

# 1. Fit initial ForestSearch model
fs_result <- forestsearch(
  df.analysis = mydata,
  outcome.name = "time",
  event.name = "status",
  treat.name = "treatment",
  confounders.name = c("age", "sex", "stage")
)

# 2. Build Cox formula
cox_formula <- build_cox_formula("time", "status", "treatment")

# 3. Get observed estimates
cox_fits <- fit_cox_models(fs_result$df.est, cox_formula)

# 4. Run bootstrap (within foreach \%dofuture\% loop)
boot_results <- bootstrap_results(
  fs.est = fs_result,
  df_boot_analysis = fs_result$df.est,
  cox.formula.boot = cox_formula,
  nb_boots = 100,
  show_three = TRUE,
  H_obs = cox_fits$H_obs,
  Hc_obs = cox_fits$Hc_obs
)
}

}
\references{
Efron, B., & Tibshirani, R. (1997). Improvements on cross-validation: the
.632+ bootstrap method. \emph{Journal of the American Statistical Association},
92(438), 548-560.
}
\seealso{
\code{\link{forestsearch_bootstrap_dofuture}} for the wrapper function that
sets up parallelization and calls this function
\code{\link{prepare_bootstrap_dataframes}} for data preparation
\code{\link{configure_forestsearch_bootstrap_args}} for argument configuration
\code{\link{get_Cox_sg}} for Cox model fitting
\code{\link{get_dfRes}} for processing bootstrap results into confidence intervals
}
\concept{bootstrap functions}
