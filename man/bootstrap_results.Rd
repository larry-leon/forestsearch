% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fs_bootstrap_optimized.r
\name{bootstrap_results}
\alias{bootstrap_results}
\title{Bootstrap Results for ForestSearch}
\usage{
bootstrap_results(
  fs.est,
  df_boot_analysis,
  cox.formula.boot,
  nb_boots,
  show_three,
  H_obs,
  Hc_obs
)
}
\arguments{
\item{fs.est}{ForestSearch results object from \code{\link{forestsearch}}.
Must contain:
\itemize{
\item \code{df.est}: Data frame with treatment recommendations
\item \code{args_call_all}: Original ForestSearch arguments
\item \code{confounders.candidate}: Candidate confounder names
\item \code{find.grps}: Subgroup search results
}}

\item{df_boot_analysis}{Data frame for bootstrap analysis. Typically the same
as \code{fs.est$df.est} but can be a different dataset for external validation.}

\item{cox.formula.boot}{Formula object for Cox regression in bootstrap.
Usually created by \code{\link{build_cox_formula}} with outcome, event,
and treatment variable names.}

\item{nb_boots}{Integer. Number of bootstrap samples to generate. Recommended
minimum is 100, with 500-1000 for final analyses. Higher values give more
stable estimates but increase computation time.}

\item{show_three}{Logical. If TRUE, displays detailed output for the first
three bootstrap iterations to help with debugging and understanding the
process. Default is FALSE.}

\item{H_obs}{Numeric. Observed hazard ratio (or log hazard ratio if on log scale)
for subgroup H (treatment not recommended group) from the original analysis.}

\item{Hc_obs}{Numeric. Observed hazard ratio (or log hazard ratio if on log scale)
for subgroup H^c (treatment recommended group) from the original analysis.}
}
\value{
A data.table with the following columns for each bootstrap iteration:
\describe{
\item{H_biasadj_1}{First bias-adjusted estimate for subgroup H using
bootstrap bias correction method 1 (simple bias correction)}
\item{H_biasadj_2}{Second bias-adjusted estimate for subgroup H using
bootstrap bias correction method 2 (double bootstrap correction)}
\item{Hc_biasadj_1}{First bias-adjusted estimate for subgroup H^c}
\item{Hc_biasadj_2}{Second bias-adjusted estimate for subgroup H^c}
\item{tmins_search}{Time in minutes for subgroup search in this bootstrap}
\item{max_sg_est}{Maximum subgroup effect estimate found}
\item{prop_maxk}{Proportion of maximum k-factor combinations evaluated}
\item{L}{Number of candidate variables in subgroup search}
\item{max_count}{Maximum number of subgroup combinations considered}
}
}
\description{
Runs bootstrap analysis for ForestSearch, fitting Cox models and performing
bias correction for subgroup treatment effect estimates. This function
performs the core bootstrap iterations, re-running ForestSearch on each
bootstrap sample to assess the stability of subgroup identification and
calculate bias-corrected confidence intervals.
}
\details{
The bootstrap procedure works as follows:
\enumerate{
\item Generate bootstrap sample with replacement from original data
\item Calculate HR estimates at original subgroups (H* and Hc*)
\item Re-run ForestSearch on bootstrap sample to find new subgroups
\item Calculate bias adjustments using the double bootstrap method
\item Store results for confidence interval calculation
}

Two bias correction methods are implemented:
\itemize{
\item \strong{Method 1}: Simple bias correction: \code{H_obs - (H** - H*obs)}
\item \strong{Method 2}: Double bootstrap: \code{2*H_obs - (H* + H** - H*obs)}
}

Where:
\itemize{
\item \code{H_obs}: Original estimate from full data
\item \code{H*}: Bootstrap estimate at original subgroup
\item \code{H*obs}: Original data evaluated at bootstrap subgroup
\item \code{H**}: Bootstrap data evaluated at bootstrap subgroup
}
}
\note{
\itemize{
\item This function is called internally by \code{\link{forestsearch_bootstrap_dofuture}}
\item Parallelization is handled by the parent function
\item NA values are returned for bootstrap iterations that don't find subgroups
\item At least 50\\% of bootstrap iterations should find subgroups for reliable results
}
}
\examples{
\dontrun{
# This function is typically called by forestsearch_bootstrap_dofuture
# but can be used directly for custom bootstrap analyses

# Prepare Cox formula
cox.formula <- build_cox_formula(
  outcome.name = "time",
  event.name = "event", 
  treat.name = "treatment"
)

# Fit initial models
cox_fits <- fit_cox_models(fs.est$df.est, cox.formula)

# Run bootstrap (usually done in parallel by parent function)
results <- bootstrap_results(
  fs.est = fs_result,
  df_boot_analysis = fs_result$df.est,
  cox.formula.boot = cox.formula,
  nb_boots = 100,
  show_three = TRUE,
  H_obs = cox_fits$H_obs,
  Hc_obs = cox_fits$Hc_obs
)

# Check proportion of successful bootstraps
prop_found <- sum(!is.na(results$H_biasadj_2)) / nrow(results)
cat("Proportion finding subgroups:", prop_found, "\n")
}

}
\references{
Efron, B. and Tibshirani, R.J. (1993). An Introduction to the Bootstrap.
Chapman & Hall/CRC.
}
\seealso{
\code{\link{forestsearch_bootstrap_dofuture}} for the main bootstrap interface,
\code{\link{forestsearch}} for the subgroup identification method,
\code{\link{get_dfRes}} for confidence interval calculation,
\code{\link{get_Cox_sg}} for Cox model fitting
}
