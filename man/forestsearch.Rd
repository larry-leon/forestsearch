% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/optimized_forest_search.r
\name{forestsearch}
\alias{forestsearch}
\title{ForestSearch: Subgroup Identification and Consistency Analysis}
\usage{
forestsearch(
  df.analysis,
  outcome.name = "tte",
  event.name = "event",
  treat.name = "treat",
  id.name = "id",
  potentialOutcome.name = NULL,
  confounders.name = NULL,
  parallel_args = list(plan = "multisession", workers = 6),
  df.predict = NULL,
  df.test = NULL,
  is.RCT = TRUE,
  seedit = 8316951,
  est.scale = "hr",
  use_lasso = TRUE,
  use_grf = TRUE,
  grf_res = NULL,
  grf_cuts = NULL,
  max_n_confounders = 1000,
  grf_depth = 2,
  dmin.grf = 12,
  frac.tau = 0.6,
  conf_force = NULL,
  defaultcut_names = NULL,
  cut_type = "default",
  exclude_cuts = NULL,
  replace_med_grf = FALSE,
  cont.cutoff = 4,
  conf.cont_medians = NULL,
  conf.cont_medians_force = NULL,
  n.min = 60,
  hr.threshold = 1.25,
  hr.consistency = 1,
  sg_focus = "hr",
  fs.splits = 1000,
  m1.threshold = Inf,
  stop.threshold = 0.9,
  pconsistency.threshold = 0.9,
  showten_subgroups = FALSE,
  d0.min = 10,
  d1.min = 10,
  max.minutes = 3,
  minp = 0.025,
  details = FALSE,
  maxk = 2,
  by.risk = 12,
  plot.sg = FALSE,
  plot.grf = FALSE,
  max_subgroups_search = 10,
  vi.grf.min = -0.2
)
}
\arguments{
\item{df.analysis}{Data frame for analysis.}

\item{outcome.name}{Character. Name of outcome variable (e.g., time-to-event).}

\item{event.name}{Character. Name of event indicator variable (0/1).}

\item{treat.name}{Character. Name of treatment group variable (0/1).}

\item{id.name}{Character. Name of ID variable.}

\item{potentialOutcome.name}{Character. Name of potential outcome variable (optional).}

\item{confounders.name}{Character vector of confounder variable names.}

\item{parallel_args}{List. Parallelization arguments (plan, workers).}

\item{df.predict}{Data frame for prediction (optional).}

\item{df.test}{Data frame for test set (optional).}

\item{is.RCT}{Logical. Is the data from a randomized controlled trial?}

\item{seedit}{Integer. Random seed.}

\item{est.scale}{Character. Effect scale (e.g., \"hr\").}

\item{use_lasso}{Logical. Use LASSO for dimension reduction.}

\item{use_grf}{Logical. Use GRF for variable selection.}

\item{grf_res}{List. Precomputed GRF results (optional).}

\item{grf_cuts}{Character vector of GRF cut expressions (optional).}

\item{max_n_confounders}{Integer. Maximum number of confounders to evaluate.}

\item{grf_depth}{Integer. Depth for GRF tree.}

\item{dmin.grf}{Numeric. Minimum treatment effect difference for GRF.}

\item{frac.tau}{Numeric. Fraction of tau for GRF horizon.}

\item{conf_force}{Character vector of forced cut expressions.}

\item{defaultcut_names}{Character vector of confounders to force default cuts.}

\item{cut_type}{Character. \"default\" or \"median\" for cut strategy.}

\item{exclude_cuts}{Character vector of cut expressions to exclude.}

\item{replace_med_grf}{Logical. Remove median cuts that overlap with GRF cuts.}

\item{cont.cutoff}{Integer. Cutoff for continuous variable determination.}

\item{conf.cont_medians}{Character vector of continuous confounders to cut at median.}

\item{conf.cont_medians_force}{Character vector of additional continuous confounders to force median cut.}

\item{n.min}{Integer. Minimum subgroup size.}

\item{hr.threshold}{Numeric. Hazard ratio threshold for subgroup selection.}

\item{hr.consistency}{Numeric. Hazard ratio threshold for consistency.}

\item{sg_focus}{Character. Subgroup focus criterion.}

\item{fs.splits}{Integer. Number of splits for consistency analysis.}

\item{m1.threshold}{Numeric. Threshold for m1 (default: Inf).}

\item{stop.threshold}{Numeric. Stopping threshold for subgroup search.}

\item{pconsistency.threshold}{Numeric. Consistency threshold for subgroup search.}

\item{showten_subgroups}{Logical. Show top ten subgroups.}

\item{d0.min}{Integer. Minimum number of events in control.}

\item{d1.min}{Integer. Minimum number of events in treatment.}

\item{max.minutes}{Numeric. Maximum minutes for search.}

\item{minp}{Numeric. Minimum proportion for subgroup.}

\item{details}{Logical. Print details during execution.}

\item{maxk}{Integer. Maximum number of subgroup factors.}

\item{by.risk}{Numeric. Interval for risk table time points.}

\item{plot.sg}{Logical. Plot subgroups.}

\item{plot.grf}{Logical. Flag to return GRF plot.}

\item{max_subgroups_search}{Integer. Maximum number of subgroups to search.}

\item{vi.grf.min}{Numeric. Minimum variable importance for GRF screening.}
}
\value{
List containing:
\describe{
\item{grp.consistency}{Consistency evaluation results}
\item{find.grps}{Subgroup search results}
\item{confounders.candidate}{Candidate confounders}
\item{confounders.evaluated}{Evaluated confounders}
\item{df.est}{Estimation dataset with treatment recommendations}
\item{df.predict}{Prediction dataset}
\item{df.test}{Test dataset}
\item{minutes_all}{Total computation time}
\item{grf_res}{GRF results}
\item{sg_focus}{Subgroup focus criterion}
\item{sg.harm}{Identified subgroup definition}
\item{grf_cuts}{GRF cut points}
\item{grf_plot}{GRF tree plot (if requested)}
\item{args_call_all}{All function arguments}
}
}
\description{
Performs subgroup identification and consistency analysis for treatment effect
heterogeneity using ForestSearch. This optimized version includes:
\itemize{
\item Faster data preparation using data.table
\item Vectorized operations where possible
\item Better memory management
\item Clearer code structure and error handling
\item Enhanced progress reporting
}
}
\examples{
\dontrun{
# Basic usage
result <- forestsearch(
  df.analysis = trial_data,
  outcome.name = "time",
  event.name = "event",
  treat.name = "treatment",
  confounders.name = c("age", "sex", "stage"),
  use_grf = TRUE,
  use_lasso = TRUE,
  details = TRUE
)

# Check if subgroup was found
if (!is.null(result$sg.harm)) {
  print(result$sg.harm)
}
}
}
